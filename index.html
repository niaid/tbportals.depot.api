<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>An R package to facilitate usage of the [TB Portals](https://tbportals.niaid.nih.gov/) DEPOT Tidy API. • tbportals.depot.api</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="bootstrap-toc.css">
<script src="bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="pkgdown.css" rel="stylesheet">
<script src="pkgdown.js"></script><meta property="og:title" content="An R package to facilitate usage of the [TB Portals](https://tbportals.niaid.nih.gov/) DEPOT Tidy API.">
<meta property="og:description" content="If you are looking for a wrapper to easily interact with the API to the Tidy Data from TB Portals then this package can provide the functionality you are looking for. Besides offering support for saving credentials information locally so that you can reuse for Authentication, the package offers a convenient function for sending API queries with flexible end points.  See [API swagger documentation](https://analytic.tbportals.niaid.nih.gov/index.html) for specific end points.
">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-home">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">tbportals.depot.api</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="articles/setting_up_connection.html">Setting up connection to API</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="contents col-md-9">
<div id="tbportalsdepotapi" class="section level1">
<div class="page-header"><h1 class="hasAnchor">
<a href="#tbportalsdepotapi" class="anchor"></a>tbportals.depot.api</h1></div>
<!-- badges: start -->
<!-- badges: end -->
<p>The goal of tbportals.depot.api is to provide a convenient wrapper functionality in R to the TB Portals Analytic API containing the Tidy data from DEPOT. For more information about TB Portals, check out their <a href="https://tbportals.niaid.nih.gov/">TB Portals website</a>.</p>
<div id="installation" class="section level2">
<h2 class="hasAnchor">
<a href="#installation" class="anchor"></a>Installation</h2>
<p>You can install the released version of tbportals.depot.api from <a href="https://CRAN.R-project.org">CRAN</a> with:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span><span class="op">(</span><span class="st">"tbportals.depot.api"</span><span class="op">)</span></code></pre></div>
</div>
<div id="example" class="section level2">
<h2 class="hasAnchor">
<a href="#example" class="anchor"></a>Example</h2>
<p>Please see Article, “Setting up connection to API”, prior to following along with the code below as it assumes you have saved your credentials locally which are required for interacting with the API.</p>
<p>This is a basic example which shows you how to solve a common problem (for other end points check out <a href="https://analytic.tbportals.niaid.nih.gov/index.html">link</a>:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.niaid.nih.gov/pages/bcbb/tbportals.depot.api">tbportals.depot.api</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">tidyverse</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://magrittr.tidyverse.org">magrittr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">ggplot2</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">ggpubr</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">arsenal</span><span class="op">)</span>

<span class="co">#Generat Token using your locally saved credentials (see article for how to set up)</span>
<span class="va">TOKEN</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/get_token.html">get_token</a></span><span class="op">(</span><span class="op">)</span>

<span class="co">## Pull the patient case data and explore some aspects of the publicly available cases</span>
<span class="va">patient_cases</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/tidy_depot_api.html">tidy_depot_api</a></span><span class="op">(</span>path <span class="op">=</span> <span class="st">"Patient-Case"</span>, token <span class="op">=</span> <span class="va">TOKEN</span><span class="op">)</span></code></pre></div>
<p>Now that patient case data has been pulled, let’s explore structure of the resulting data:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#Data.frame dimensions of the resulting JSON data from the API call"</span>
<span class="va">patient_cases</span><span class="op">$</span><span class="va">content</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; [1] 4041  204</span>

<span class="co">#End point used for the API call</span>
<span class="va">patient_cases</span><span class="op">$</span><span class="va">path</span>
<span class="co">#&gt; [1] "Patient-Case"</span>

<span class="co">#The httr response content containing the specific information about the call</span>
<span class="va">patient_cases</span><span class="op">$</span><span class="va">response</span>
<span class="co">#&gt; Response [https://analytic.tbportals.niaid.nih.gov/api/Patient-Case?returnCsv=false]</span>
<span class="co">#&gt;   Date: 2021-04-15 12:57</span>
<span class="co">#&gt;   Status: 200</span>
<span class="co">#&gt;   Content-Type: application/json; charset=utf-8</span>
<span class="co">#&gt;   Size: 30.4 MB</span></code></pre></div>
<p>Let’s explore some aspects of the patient cases:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Store data.frame of patient case characteristics</span>
<span class="va">patient_cases_df</span> <span class="op">&lt;-</span> <span class="va">patient_cases</span><span class="op">$</span><span class="va">content</span>

<span class="co"># Select attributes of interest</span>
<span class="va">patient_cases_df</span> <span class="op">%&lt;&gt;%</span>
  <span class="fu">select</span><span class="op">(</span><span class="va">condition_id</span>, <span class="va">patient_id</span>, <span class="va">age_of_onset</span>, <span class="va">gender</span>, <span class="va">country</span>, <span class="va">case_definition</span>, <span class="va">type_of_resistance</span><span class="op">)</span>

<span class="co"># Summarise number of conditions by patient_id</span>
<span class="va">patient_cases_df</span> <span class="op">%&lt;&gt;%</span>
  <span class="fu">group_by</span><span class="op">(</span><span class="va">patient_id</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">mutate</span><span class="op">(</span>num_conditions <span class="op">=</span> <span class="fu">n_distinct</span><span class="op">(</span><span class="va">condition_id</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">select</span><span class="op">(</span><span class="op">-</span><span class="va">condition_id</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">distinct</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/utils/type.convert.html">type.convert</a></span><span class="op">(</span><span class="op">)</span>

<span class="co"># Patient counts by type of resistance and other case characteristics</span>
<span class="fu">tableby</span><span class="op">(</span><span class="va">type_of_resistance</span> <span class="op">~</span> <span class="va">age_of_onset</span> <span class="op">+</span> <span class="va">gender</span> <span class="op">+</span> <span class="va">country</span> <span class="op">+</span> <span class="va">case_definition</span>, data <span class="op">=</span> <span class="va">patient_cases_df</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<table class="table">
<colgroup>
<col width="14%">
<col width="14%">
<col width="10%">
<col width="10%">
<col width="10%">
<col width="12%">
<col width="10%">
<col width="10%">
<col width="5%">
</colgroup>
<thead><tr class="header">
<th align="left"></th>
<th align="center">MDR non XDR (N=1845)</th>
<th align="center">Mono DR (N=306)</th>
<th align="center">Poly DR (N=133)</th>
<th align="center">Pre-XDR (N=14)</th>
<th align="center">Sensitive (N=987)</th>
<th align="center">XDR (N=755)</th>
<th align="center">Total (N=4040)</th>
<th align="right">p value</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left"><strong>age_of_onset</strong></td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
<td align="right">0.429</td>
</tr>
<tr class="even">
<td align="left">Mean (SD)</td>
<td align="center">41.095 (13.377)</td>
<td align="center">41.111 (15.132)</td>
<td align="center">43.286 (14.774)</td>
<td align="center">40.714 (12.098)</td>
<td align="center">41.827 (15.953)</td>
<td align="center">40.955 (12.909)</td>
<td align="center">41.320 (14.145)</td>
<td align="right"></td>
</tr>
<tr class="odd">
<td align="left">Range</td>
<td align="center">3.000 - 85.000</td>
<td align="center">8.000 - 87.000</td>
<td align="center">19.000 - 93.000</td>
<td align="center">24.000 - 63.000</td>
<td align="center">2.000 - 87.000</td>
<td align="center">15.000 - 84.000</td>
<td align="center">2.000 - 93.000</td>
<td align="right"></td>
</tr>
<tr class="even">
<td align="left"><strong>gender</strong></td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
<td align="right">0.282</td>
</tr>
<tr class="odd">
<td align="left">Female</td>
<td align="center">482 (26.1%)</td>
<td align="center">86 (28.1%)</td>
<td align="center">38 (28.6%)</td>
<td align="center">3 (21.4%)</td>
<td align="center">300 (30.4%)</td>
<td align="center">212 (28.1%)</td>
<td align="center">1121 (27.7%)</td>
<td align="right"></td>
</tr>
<tr class="even">
<td align="left">Male</td>
<td align="center">1363 (73.9%)</td>
<td align="center">220 (71.9%)</td>
<td align="center">95 (71.4%)</td>
<td align="center">11 (78.6%)</td>
<td align="center">687 (69.6%)</td>
<td align="center">543 (71.9%)</td>
<td align="center">2919 (72.3%)</td>
<td align="right"></td>
</tr>
<tr class="odd">
<td align="left"><strong>country</strong></td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
<td align="right">&lt; 0.001</td>
</tr>
<tr class="even">
<td align="left">Azerbaijan</td>
<td align="center">178 (9.6%)</td>
<td align="center">6 (2.0%)</td>
<td align="center">3 (2.3%)</td>
<td align="center">0 (0.0%)</td>
<td align="center">54 (5.5%)</td>
<td align="center">97 (12.8%)</td>
<td align="center">338 (8.4%)</td>
<td align="right"></td>
</tr>
<tr class="odd">
<td align="left">Belarus</td>
<td align="center">445 (24.1%)</td>
<td align="center">27 (8.8%)</td>
<td align="center">15 (11.3%)</td>
<td align="center">0 (0.0%)</td>
<td align="center">156 (15.8%)</td>
<td align="center">289 (38.3%)</td>
<td align="center">932 (23.1%)</td>
<td align="right"></td>
</tr>
<tr class="even">
<td align="left">Georgia</td>
<td align="center">373 (20.2%)</td>
<td align="center">78 (25.5%)</td>
<td align="center">69 (51.9%)</td>
<td align="center">0 (0.0%)</td>
<td align="center">452 (45.8%)</td>
<td align="center">90 (11.9%)</td>
<td align="center">1062 (26.3%)</td>
<td align="right"></td>
</tr>
<tr class="odd">
<td align="left">India</td>
<td align="center">3 (0.2%)</td>
<td align="center">7 (2.3%)</td>
<td align="center">3 (2.3%)</td>
<td align="center">0 (0.0%)</td>
<td align="center">7 (0.7%)</td>
<td align="center">1 (0.1%)</td>
<td align="center">21 (0.5%)</td>
<td align="right"></td>
</tr>
<tr class="even">
<td align="left">Kazakhstan</td>
<td align="center">114 (6.2%)</td>
<td align="center">10 (3.3%)</td>
<td align="center">12 (9.0%)</td>
<td align="center">7 (50.0%)</td>
<td align="center">64 (6.5%)</td>
<td align="center">38 (5.0%)</td>
<td align="center">245 (6.1%)</td>
<td align="right"></td>
</tr>
<tr class="odd">
<td align="left">Moldova</td>
<td align="center">377 (20.4%)</td>
<td align="center">43 (14.1%)</td>
<td align="center">22 (16.5%)</td>
<td align="center">0 (0.0%)</td>
<td align="center">181 (18.3%)</td>
<td align="center">86 (11.4%)</td>
<td align="center">709 (17.5%)</td>
<td align="right"></td>
</tr>
<tr class="even">
<td align="left">Nigeria</td>
<td align="center">34 (1.8%)</td>
<td align="center">83 (27.1%)</td>
<td align="center">0 (0.0%)</td>
<td align="center">0 (0.0%)</td>
<td align="center">0 (0.0%)</td>
<td align="center">0 (0.0%)</td>
<td align="center">117 (2.9%)</td>
<td align="right"></td>
</tr>
<tr class="odd">
<td align="left">Romania</td>
<td align="center">167 (9.1%)</td>
<td align="center">35 (11.4%)</td>
<td align="center">7 (5.3%)</td>
<td align="center">0 (0.0%)</td>
<td align="center">21 (2.1%)</td>
<td align="center">65 (8.6%)</td>
<td align="center">295 (7.3%)</td>
<td align="right"></td>
</tr>
<tr class="even">
<td align="left">Ukraine</td>
<td align="center">154 (8.3%)</td>
<td align="center">17 (5.6%)</td>
<td align="center">2 (1.5%)</td>
<td align="center">7 (50.0%)</td>
<td align="center">52 (5.3%)</td>
<td align="center">89 (11.8%)</td>
<td align="center">321 (7.9%)</td>
<td align="right"></td>
</tr>
<tr class="odd">
<td align="left"><strong>case_definition</strong></td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
<td align="right">&lt; 0.001</td>
</tr>
<tr class="even">
<td align="left">Chronic TB</td>
<td align="center">34 (1.8%)</td>
<td align="center">0 (0.0%)</td>
<td align="center">0 (0.0%)</td>
<td align="center">3 (21.4%)</td>
<td align="center">0 (0.0%)</td>
<td align="center">29 (3.8%)</td>
<td align="center">66 (1.6%)</td>
<td align="right"></td>
</tr>
<tr class="odd">
<td align="left">Failure</td>
<td align="center">221 (12.0%)</td>
<td align="center">25 (8.2%)</td>
<td align="center">9 (6.8%)</td>
<td align="center">2 (14.3%)</td>
<td align="center">15 (1.5%)</td>
<td align="center">260 (34.4%)</td>
<td align="center">532 (13.2%)</td>
<td align="right"></td>
</tr>
<tr class="even">
<td align="left">Lost to follow up</td>
<td align="center">177 (9.6%)</td>
<td align="center">10 (3.3%)</td>
<td align="center">10 (7.5%)</td>
<td align="center">1 (7.1%)</td>
<td align="center">33 (3.3%)</td>
<td align="center">52 (6.9%)</td>
<td align="center">283 (7.0%)</td>
<td align="right"></td>
</tr>
<tr class="odd">
<td align="left">New</td>
<td align="center">924 (50.1%)</td>
<td align="center">214 (69.9%)</td>
<td align="center">86 (64.7%)</td>
<td align="center">4 (28.6%)</td>
<td align="center">802 (81.3%)</td>
<td align="center">182 (24.1%)</td>
<td align="center">2212 (54.8%)</td>
<td align="right"></td>
</tr>
<tr class="even">
<td align="left">Other</td>
<td align="center">39 (2.1%)</td>
<td align="center">4 (1.3%)</td>
<td align="center">6 (4.5%)</td>
<td align="center">1 (7.1%)</td>
<td align="center">15 (1.5%)</td>
<td align="center">35 (4.6%)</td>
<td align="center">100 (2.5%)</td>
<td align="right"></td>
</tr>
<tr class="odd">
<td align="left">Relapse</td>
<td align="center">449 (24.3%)</td>
<td align="center">52 (17.0%)</td>
<td align="center">21 (15.8%)</td>
<td align="center">3 (21.4%)</td>
<td align="center">120 (12.2%)</td>
<td align="center">197 (26.1%)</td>
<td align="center">842 (20.8%)</td>
<td align="right"></td>
</tr>
<tr class="even">
<td align="left">Unknown</td>
<td align="center">1 (0.1%)</td>
<td align="center">1 (0.3%)</td>
<td align="center">1 (0.8%)</td>
<td align="center">0 (0.0%)</td>
<td align="center">2 (0.2%)</td>
<td align="center">0 (0.0%)</td>
<td align="center">5 (0.1%)</td>
<td align="right"></td>
</tr>
</tbody>
</table>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <div class="license">
<h2>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small>CC0</small></li>
</ul>
</div>
<div class="developers">
<h2>Developers</h2>
<ul class="list-unstyled">
<li>Gabriel Rosenfeld <br><small class="roles"> Maintainer </small>  </li>
</ul>
</div>

  </div>
</div>


      <footer><div class="copyright">
  <p>Developed by Gabriel Rosenfeld.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
