<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Convenient R wrapper for TB Portals DEPOT Tidy API • tbportals.depot.api</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="bootstrap-toc.css">
<script src="bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="pkgdown.css" rel="stylesheet">
<script src="pkgdown.js"></script><meta property="og:title" content="Convenient R wrapper for TB Portals DEPOT Tidy API">
<meta property="og:description" content="Provides a convenient way of interacting with the TB Portals DEPOT Tidy API.
    Includes methods for setting up authorization as well as creating API calls to the various
    end points that are available.">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-home">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">tbportals.depot.api</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="reference/index.html">Reference</a>
</li>
<li>
  <a href="articles/index.html">Articles</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="contents col-md-9">
<div id="tbportalsdepotapi" class="section level1">
<div class="page-header"><h1 class="hasAnchor">
<a href="#tbportalsdepotapi" class="anchor"></a>tbportals.depot.api</h1></div>
<!-- badges: start -->
<!-- badges: end -->
<p>tbportals.depot.api aims to provide a convenient wrapper functionality in R to the TB Portals Analytic API containing the tidy data from TB Portals DEPOT database. For more information about TB Portals, check out their <a href="https://tbportals.niaid.nih.gov/">TB Portals website</a>.</p>
<div id="installation" class="section level2">
<h2 class="hasAnchor">
<a href="#installation" class="anchor"></a>Installation</h2>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://devtools.r-lib.org//reference/remote-reexports.html">install_github</a></span><span class="op">(</span><span class="st">"niaid/tbportals.depot.api"</span><span class="op">)</span></code></pre></div>
</div>
<div id="example" class="section level2">
<h2 class="hasAnchor">
<a href="#example" class="anchor"></a>Example</h2>
<p>Please see Article, “Setting up connection to API”, prior to following along with the code below as it assumes you have saved your credentials locally which are required for interacting with the API.</p>
<p>This is a basic example which shows you how to solve a common problem (for other end points check out <a href="https://analytic.tbportals.niaid.nih.gov/index.html">link</a>:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.niaid.nih.gov/pages/bcbb/tbportals.depot.api">tbportals.depot.api</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">tidyverse</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://magrittr.tidyverse.org">magrittr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">ggplot2</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">ggpubr</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">arsenal</span><span class="op">)</span>

<span class="co">#Generat Token using your locally saved credentials (see article for how to set up)</span>
<span class="va">TOKEN</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/get_token.html">get_token</a></span><span class="op">(</span><span class="op">)</span>

<span class="co">## Pull the patient case data and explore some aspects of the publicly available cases</span>
<span class="va">patient_cases</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/tidy_depot_api.html">tidy_depot_api</a></span><span class="op">(</span>path <span class="op">=</span> <span class="st">"Patient-Case"</span>, token <span class="op">=</span> <span class="va">TOKEN</span><span class="op">)</span></code></pre></div>
<p>Now that patient case data has been pulled, let’s explore structure of the resulting data:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#Data.frame dimensions of the resulting JSON data from the API call"</span>
<span class="va">patient_cases</span><span class="op">$</span><span class="va">content</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; [1] 4536  204</span>

<span class="co">#End point used for the API call</span>
<span class="va">patient_cases</span><span class="op">$</span><span class="va">path</span>
<span class="co">#&gt; [1] "Patient-Case"</span>

<span class="co">#The httr response content containing the specific information about the call</span>
<span class="va">patient_cases</span><span class="op">$</span><span class="va">response</span>
<span class="co">#&gt; Response [https://analytic.tbportals.niaid.nih.gov/api/Patient-Case?returnCsv=false&amp;cohortId=]</span>
<span class="co">#&gt;   Date: 2021-05-20 17:30</span>
<span class="co">#&gt;   Status: 200</span>
<span class="co">#&gt;   Content-Type: application/json; charset=utf-8</span>
<span class="co">#&gt;   Size: 34.5 MB</span></code></pre></div>
<p>Let’s explore some aspects of the patient cases:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Store data.frame of patient case characteristics</span>
<span class="va">patient_cases_df</span> <span class="op">&lt;-</span> <span class="va">patient_cases</span><span class="op">$</span><span class="va">content</span>

<span class="co"># Select attributes of interest</span>
<span class="va">patient_cases_df</span> <span class="op">%&lt;&gt;%</span>
  <span class="fu">select</span><span class="op">(</span><span class="va">condition_id</span>, <span class="va">patient_id</span>, <span class="va">age_of_onset</span>, <span class="va">gender</span>, <span class="va">bmi</span>, <span class="va">case_definition</span>, <span class="va">type_of_resistance</span><span class="op">)</span>

<span class="co"># Summarise number of conditions by patient_id</span>
<span class="va">patient_cases_df</span> <span class="op">%&lt;&gt;%</span>
  <span class="fu">group_by</span><span class="op">(</span><span class="va">patient_id</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">mutate</span><span class="op">(</span>num_conditions <span class="op">=</span> <span class="fu">n_distinct</span><span class="op">(</span><span class="va">condition_id</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">select</span><span class="op">(</span><span class="op">-</span><span class="va">condition_id</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">distinct</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/utils/type.convert.html">type.convert</a></span><span class="op">(</span><span class="op">)</span>

<span class="co"># Patient counts by type of resistance and other case characteristics</span>
<span class="fu">tableby</span><span class="op">(</span><span class="va">type_of_resistance</span> <span class="op">~</span> <span class="va">age_of_onset</span> <span class="op">+</span> <span class="va">gender</span> <span class="op">+</span> <span class="va">bmi</span> <span class="op">+</span> <span class="va">case_definition</span>, data <span class="op">=</span> <span class="va">patient_cases_df</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<table class="table">
<colgroup>
<col width="14%">
<col width="14%">
<col width="10%">
<col width="10%">
<col width="10%">
<col width="12%">
<col width="10%">
<col width="10%">
<col width="5%">
</colgroup>
<thead><tr class="header">
<th align="left"></th>
<th align="center">MDR non XDR (N=2168)</th>
<th align="center">Mono DR (N=315)</th>
<th align="center">Poly DR (N=141)</th>
<th align="center">Pre-XDR (N=24)</th>
<th align="center">Sensitive (N=1069)</th>
<th align="center">XDR (N=819)</th>
<th align="center">Total (N=4536)</th>
<th align="right">p value</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left"><strong>age_of_onset</strong></td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
<td align="right">0.294</td>
</tr>
<tr class="even">
<td align="left">Mean (SD)</td>
<td align="center">41.231 (13.196)</td>
<td align="center">41.390 (15.113)</td>
<td align="center">43.106 (14.742)</td>
<td align="center">43.458 (14.709)</td>
<td align="center">42.213 (15.824)</td>
<td align="center">41.248 (12.941)</td>
<td align="center">41.547 (14.010)</td>
<td align="right"></td>
</tr>
<tr class="odd">
<td align="left">Range</td>
<td align="center">3.000 - 85.000</td>
<td align="center">8.000 - 87.000</td>
<td align="center">19.000 - 93.000</td>
<td align="center">24.000 - 90.000</td>
<td align="center">2.000 - 87.000</td>
<td align="center">15.000 - 84.000</td>
<td align="center">2.000 - 93.000</td>
<td align="right"></td>
</tr>
<tr class="even">
<td align="left"><strong>gender</strong></td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
<td align="right">0.328</td>
</tr>
<tr class="odd">
<td align="left">Female</td>
<td align="center">559 (25.8%)</td>
<td align="center">86 (27.3%)</td>
<td align="center">39 (27.7%)</td>
<td align="center">6 (25.0%)</td>
<td align="center">318 (29.7%)</td>
<td align="center">224 (27.4%)</td>
<td align="center">1232 (27.2%)</td>
<td align="right"></td>
</tr>
<tr class="even">
<td align="left">Male</td>
<td align="center">1609 (74.2%)</td>
<td align="center">229 (72.7%)</td>
<td align="center">102 (72.3%)</td>
<td align="center">18 (75.0%)</td>
<td align="center">751 (70.3%)</td>
<td align="center">595 (72.6%)</td>
<td align="center">3304 (72.8%)</td>
<td align="right"></td>
</tr>
<tr class="odd">
<td align="left"><strong>bmi</strong></td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
<td align="right">&lt; 0.001</td>
</tr>
<tr class="even">
<td align="left">N-Miss</td>
<td align="center">330</td>
<td align="center">151</td>
<td align="center">59</td>
<td align="center">0</td>
<td align="center">583</td>
<td align="center">67</td>
<td align="center">1190</td>
<td align="right"></td>
</tr>
<tr class="odd">
<td align="left">Mean (SD)</td>
<td align="center">20.762 (3.455)</td>
<td align="center">20.939 (4.737)</td>
<td align="center">20.946 (4.248)</td>
<td align="center">19.842 (4.843)</td>
<td align="center">21.530 (3.925)</td>
<td align="center">20.650 (3.651)</td>
<td align="center">20.855 (3.683)</td>
<td align="right"></td>
</tr>
<tr class="even">
<td align="left">Range</td>
<td align="center">12.800 - 40.300</td>
<td align="center">12.900 - 61.100</td>
<td align="center">13.400 - 40.700</td>
<td align="center">12.100 - 29.000</td>
<td align="center">11.700 - 36.500</td>
<td align="center">11.800 - 38.600</td>
<td align="center">11.700 - 61.100</td>
<td align="right"></td>
</tr>
<tr class="odd">
<td align="left"><strong>case_definition</strong></td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
<td align="right">&lt; 0.001</td>
</tr>
<tr class="even">
<td align="left">Chronic TB</td>
<td align="center">41 (1.9%)</td>
<td align="center">0 (0.0%)</td>
<td align="center">0 (0.0%)</td>
<td align="center">4 (16.7%)</td>
<td align="center">0 (0.0%)</td>
<td align="center">43 (5.3%)</td>
<td align="center">88 (1.9%)</td>
<td align="right"></td>
</tr>
<tr class="odd">
<td align="left">Failure</td>
<td align="center">261 (12.0%)</td>
<td align="center">25 (7.9%)</td>
<td align="center">9 (6.4%)</td>
<td align="center">2 (8.3%)</td>
<td align="center">19 (1.8%)</td>
<td align="center">270 (33.0%)</td>
<td align="center">586 (12.9%)</td>
<td align="right"></td>
</tr>
<tr class="even">
<td align="left">Lost to follow up</td>
<td align="center">181 (8.3%)</td>
<td align="center">10 (3.2%)</td>
<td align="center">10 (7.1%)</td>
<td align="center">1 (4.2%)</td>
<td align="center">36 (3.4%)</td>
<td align="center">54 (6.6%)</td>
<td align="center">292 (6.4%)</td>
<td align="right"></td>
</tr>
<tr class="odd">
<td align="left">New</td>
<td align="center">1105 (51.0%)</td>
<td align="center">221 (70.2%)</td>
<td align="center">94 (66.7%)</td>
<td align="center">9 (37.5%)</td>
<td align="center">866 (81.0%)</td>
<td align="center">196 (23.9%)</td>
<td align="center">2491 (54.9%)</td>
<td align="right"></td>
</tr>
<tr class="even">
<td align="left">Other</td>
<td align="center">43 (2.0%)</td>
<td align="center">4 (1.3%)</td>
<td align="center">6 (4.3%)</td>
<td align="center">2 (8.3%)</td>
<td align="center">17 (1.6%)</td>
<td align="center">38 (4.6%)</td>
<td align="center">110 (2.4%)</td>
<td align="right"></td>
</tr>
<tr class="odd">
<td align="left">Relapse</td>
<td align="center">536 (24.7%)</td>
<td align="center">54 (17.1%)</td>
<td align="center">21 (14.9%)</td>
<td align="center">6 (25.0%)</td>
<td align="center">129 (12.1%)</td>
<td align="center">218 (26.6%)</td>
<td align="center">964 (21.3%)</td>
<td align="right"></td>
</tr>
<tr class="even">
<td align="left">Unknown</td>
<td align="center">1 (0.0%)</td>
<td align="center">1 (0.3%)</td>
<td align="center">1 (0.7%)</td>
<td align="center">0 (0.0%)</td>
<td align="center">2 (0.2%)</td>
<td align="center">0 (0.0%)</td>
<td align="center">5 (0.1%)</td>
<td align="right"></td>
</tr>
</tbody>
</table>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <div class="license">
<h2>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small>CC0</small></li>
</ul>
</div>
<div class="developers">
<h2>Developers</h2>
<ul class="list-unstyled">
<li>Gabriel Rosenfeld <br><small class="roles"> Maintainer </small>  </li>
</ul>
</div>

  </div>
</div>


      <footer><div class="copyright">
  <p>Developed by Gabriel Rosenfeld.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
