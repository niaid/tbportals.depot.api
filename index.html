<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Convenient R wrapper for TB Portals DEPOT Tidy API • tbportals.depot.api</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="bootstrap-toc.css">
<script src="bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="pkgdown.css" rel="stylesheet">
<script src="pkgdown.js"></script><meta property="og:title" content="Convenient R wrapper for TB Portals DEPOT Tidy API">
<meta property="og:description" content="Provides a convenient way of interacting with the TB Portals DEPOT Tidy API.
    Includes methods for setting up authorization as well as creating API calls to the various
    end points that are available.">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-home">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">tbportals.depot.api</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="articles/pulling_data_from_depot_cohort.html">Pulling data from the API and filtering on records in a DEPOT created cohort</a>
    </li>
    <li>
      <a href="articles/setting_up_connection.html">Setting up connection to API</a>
    </li>
  </ul>
</li>
<li>
  <a href="news/index.html">News</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="contents col-md-9">
<div id="tbportalsdepotapi" class="section level1">
<div class="page-header"><h1 class="hasAnchor">
<a href="#tbportalsdepotapi" class="anchor"></a>tbportals.depot.api</h1></div>
<!-- badges: start -->

<p>tbportals.depot.api R package aims to provide a convenient wrapper functionality in R to the TB Portals Analytic API containing the tidy analytic data from TB Portals DEPOT database. For more information about TB Portals, check out the <a href="https://tbportals.niaid.nih.gov/">TB Portals website</a>.</p>
<div id="installation" class="section level2">
<h2 class="hasAnchor">
<a href="#installation" class="anchor"></a>Installation</h2>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Install release version from CRAN</span>
<span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span><span class="op">(</span><span class="st">"tbportals.depot.api"</span><span class="op">)</span>

<span class="co"># Install development version from GitHub</span>
<span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://devtools.r-lib.org//reference/remote-reexports.html">install_github</a></span><span class="op">(</span><span class="st">"niaid/tbportals.depot.api"</span><span class="op">)</span></code></pre></div>
</div>
<div id="usage" class="section level2">
<h2 class="hasAnchor">
<a href="#usage" class="anchor"></a>Usage</h2>
<p>Please see Article, “Setting up connection to API”, before following along with the code example below as it assumes you have saved your credentials locally which are required for interacting with the API.</p>
<p>This is a basic example which shows you how to solve a common problem of pulling all the data from an endpoint (for other end points check out <a href="https://analytic.tbportals.niaid.nih.gov/index.html">link</a>:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.niaid.nih.gov/pages/bcbb/tbportals.depot.api">tbportals.depot.api</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">tidyverse</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://magrittr.tidyverse.org">magrittr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">arsenal</span><span class="op">)</span>

<span class="co"># Generate Token using your locally saved credentials (see article for how to set up)</span>
<span class="va">TOKEN</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/get_token.html">get_token</a></span><span class="op">(</span><span class="op">)</span>

<span class="co"># Pull the patient case data and explore some aspects of the publicly available cases</span>
<span class="va">patient_cases</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/tidy_depot_api.html">tidy_depot_api</a></span><span class="op">(</span>path <span class="op">=</span> <span class="st">"Patient-Case"</span>, token <span class="op">=</span> <span class="va">TOKEN</span><span class="op">)</span></code></pre></div>
<p>Now that patient case data has been pulled, let’s explore structure of the resulting data. The request is returned as its own class with the structured data from the API call in the “content”, the endpoint url nin the “path”, and the actually http response in the “response”.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#Data.frame dimensions of the resulting JSON data from the API call"</span>
<span class="va">patient_cases</span><span class="op">$</span><span class="va">content</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; [1] 5339  204</span>

<span class="co">#End point used for the API call</span>
<span class="va">patient_cases</span><span class="op">$</span><span class="va">path</span>
<span class="co">#&gt; [1] "Patient-Case"</span>

<span class="co">#The httr response content containing the specific information about the call</span>
<span class="va">patient_cases</span><span class="op">$</span><span class="va">response</span>
<span class="co">#&gt; Response [https://analytic.tbportals.niaid.nih.gov/api/Patient-Case?returnCsv=false&amp;cohortId=]</span>
<span class="co">#&gt;   Date: 2021-08-10 21:19</span>
<span class="co">#&gt;   Status: 200</span>
<span class="co">#&gt;   Content-Type: application/json; charset=utf-8</span>
<span class="co">#&gt;   Size: 41 MB</span></code></pre></div>
<p>Let’s explore some aspects of the patient cases stratifying by the type of drug resistance associated with the case to get a sense of the number of publicly shared data available.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Store data.frame of patient case characteristics</span>
<span class="va">patient_cases_df</span> <span class="op">&lt;-</span> <span class="va">patient_cases</span><span class="op">$</span><span class="va">content</span>

<span class="co"># Select attributes of interest</span>
<span class="va">patient_cases_df</span> <span class="op">%&lt;&gt;%</span>
  <span class="fu">select</span><span class="op">(</span><span class="va">condition_id</span>, <span class="va">patient_id</span>, <span class="va">age_of_onset</span>, <span class="va">gender</span>, <span class="va">bmi</span>, <span class="va">case_definition</span>, <span class="va">type_of_resistance</span><span class="op">)</span>

<span class="co"># Summarise number of conditions by patient_id</span>
<span class="va">patient_cases_df</span> <span class="op">%&lt;&gt;%</span>
  <span class="fu">group_by</span><span class="op">(</span><span class="va">patient_id</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">mutate</span><span class="op">(</span>num_conditions <span class="op">=</span> <span class="fu">n_distinct</span><span class="op">(</span><span class="va">condition_id</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">select</span><span class="op">(</span><span class="op">-</span><span class="va">condition_id</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">distinct</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/utils/type.convert.html">type.convert</a></span><span class="op">(</span><span class="op">)</span>

<span class="co"># Patient counts by type of resistance and other case characteristics</span>
<span class="fu">tableby</span><span class="op">(</span><span class="va">type_of_resistance</span> <span class="op">~</span> <span class="va">age_of_onset</span> <span class="op">+</span> <span class="va">gender</span> <span class="op">+</span> <span class="va">bmi</span> <span class="op">+</span> <span class="va">case_definition</span>, data <span class="op">=</span> <span class="va">patient_cases_df</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<table class="table">
<colgroup>
<col width="14%">
<col width="14%">
<col width="10%">
<col width="10%">
<col width="10%">
<col width="12%">
<col width="10%">
<col width="10%">
<col width="5%">
</colgroup>
<thead><tr class="header">
<th align="left"></th>
<th align="center">MDR non XDR (N=2346)</th>
<th align="center">Mono DR (N=380)</th>
<th align="center">Poly DR (N=173)</th>
<th align="center">Pre-XDR (N=37)</th>
<th align="center">Sensitive (N=1540)</th>
<th align="center">XDR (N=863)</th>
<th align="center">Total (N=5339)</th>
<th align="right">p value</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left"><strong>age_of_onset</strong></td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
<td align="right">0.004</td>
</tr>
<tr class="even">
<td align="left">Mean (SD)</td>
<td align="center">41.231 (13.194)</td>
<td align="center">41.779 (14.909)</td>
<td align="center">42.399 (14.913)</td>
<td align="center">41.838 (13.779)</td>
<td align="center">43.051 (15.468)</td>
<td align="center">41.393 (12.941)</td>
<td align="center">41.863 (14.048)</td>
<td align="right"></td>
</tr>
<tr class="odd">
<td align="left">Range</td>
<td align="center">3.000 - 85.000</td>
<td align="center">8.000 - 87.000</td>
<td align="center">18.000 - 93.000</td>
<td align="center">21.000 - 90.000</td>
<td align="center">2.000 - 88.000</td>
<td align="center">15.000 - 84.000</td>
<td align="center">2.000 - 93.000</td>
<td align="right"></td>
</tr>
<tr class="even">
<td align="left"><strong>gender</strong></td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
<td align="right">0.546</td>
</tr>
<tr class="odd">
<td align="left">Female</td>
<td align="center">604 (25.7%)</td>
<td align="center">105 (27.6%)</td>
<td align="center">50 (28.9%)</td>
<td align="center">9 (24.3%)</td>
<td align="center">438 (28.4%)</td>
<td align="center">232 (26.9%)</td>
<td align="center">1438 (26.9%)</td>
<td align="right"></td>
</tr>
<tr class="even">
<td align="left">Male</td>
<td align="center">1742 (74.3%)</td>
<td align="center">275 (72.4%)</td>
<td align="center">123 (71.1%)</td>
<td align="center">28 (75.7%)</td>
<td align="center">1102 (71.6%)</td>
<td align="center">631 (73.1%)</td>
<td align="center">3901 (73.1%)</td>
<td align="right"></td>
</tr>
<tr class="odd">
<td align="left"><strong>bmi</strong></td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
<td align="right">0.007</td>
</tr>
<tr class="even">
<td align="left">N-Miss</td>
<td align="center">353</td>
<td align="center">163</td>
<td align="center">68</td>
<td align="center">0</td>
<td align="center">649</td>
<td align="center">68</td>
<td align="center">1301</td>
<td align="right"></td>
</tr>
<tr class="odd">
<td align="left">Mean (SD)</td>
<td align="center">20.667 (3.442)</td>
<td align="center">20.699 (4.355)</td>
<td align="center">20.502 (3.996)</td>
<td align="center">19.586 (4.291)</td>
<td align="center">21.126 (3.751)</td>
<td align="center">20.626 (3.675)</td>
<td align="center">20.748 (3.640)</td>
<td align="right"></td>
</tr>
<tr class="even">
<td align="left">Range</td>
<td align="center">12.800 - 40.300</td>
<td align="center">12.900 - 61.100</td>
<td align="center">13.400 - 40.700</td>
<td align="center">12.100 - 29.000</td>
<td align="center">11.700 - 36.500</td>
<td align="center">11.800 - 38.600</td>
<td align="center">11.700 - 61.100</td>
<td align="right"></td>
</tr>
<tr class="odd">
<td align="left"><strong>case_definition</strong></td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
<td align="right">&lt; 0.001</td>
</tr>
<tr class="even">
<td align="left">Chronic TB</td>
<td align="center">47 (2.0%)</td>
<td align="center">0 (0.0%)</td>
<td align="center">0 (0.0%)</td>
<td align="center">6 (16.2%)</td>
<td align="center">1 (0.1%)</td>
<td align="center">53 (6.1%)</td>
<td align="center">107 (2.0%)</td>
<td align="right"></td>
</tr>
<tr class="odd">
<td align="left">Failure</td>
<td align="center">268 (11.4%)</td>
<td align="center">28 (7.4%)</td>
<td align="center">9 (5.2%)</td>
<td align="center">2 (5.4%)</td>
<td align="center">27 (1.8%)</td>
<td align="center">277 (32.1%)</td>
<td align="center">611 (11.4%)</td>
<td align="right"></td>
</tr>
<tr class="even">
<td align="left">Lost to follow up</td>
<td align="center">191 (8.1%)</td>
<td align="center">10 (2.6%)</td>
<td align="center">11 (6.4%)</td>
<td align="center">3 (8.1%)</td>
<td align="center">37 (2.4%)</td>
<td align="center">55 (6.4%)</td>
<td align="center">307 (5.8%)</td>
<td align="right"></td>
</tr>
<tr class="odd">
<td align="left">New</td>
<td align="center">1217 (51.9%)</td>
<td align="center">272 (71.6%)</td>
<td align="center">124 (71.7%)</td>
<td align="center">16 (43.2%)</td>
<td align="center">1290 (83.8%)</td>
<td align="center">213 (24.7%)</td>
<td align="center">3132 (58.7%)</td>
<td align="right"></td>
</tr>
<tr class="even">
<td align="left">Other</td>
<td align="center">49 (2.1%)</td>
<td align="center">5 (1.3%)</td>
<td align="center">6 (3.5%)</td>
<td align="center">3 (8.1%)</td>
<td align="center">18 (1.2%)</td>
<td align="center">40 (4.6%)</td>
<td align="center">121 (2.3%)</td>
<td align="right"></td>
</tr>
<tr class="odd">
<td align="left">Relapse</td>
<td align="center">573 (24.4%)</td>
<td align="center">64 (16.8%)</td>
<td align="center">22 (12.7%)</td>
<td align="center">7 (18.9%)</td>
<td align="center">165 (10.7%)</td>
<td align="center">225 (26.1%)</td>
<td align="center">1056 (19.8%)</td>
<td align="right"></td>
</tr>
<tr class="even">
<td align="left">Unknown</td>
<td align="center">1 (0.0%)</td>
<td align="center">1 (0.3%)</td>
<td align="center">1 (0.6%)</td>
<td align="center">0 (0.0%)</td>
<td align="center">2 (0.1%)</td>
<td align="center">0 (0.0%)</td>
<td align="center">5 (0.1%)</td>
<td align="right"></td>
</tr>
</tbody>
</table>
<p>If interested in other available endpoints, you can use the list_endpoints function for a data.frame of currently available endpoints.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># This function lists endpoints as a data.frame along with a brief description</span>
<span class="fu"><a href="reference/list_endpoints.html">list_endpoints</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code>            endpoint                                         description</code></pre>
<p>1 Biochemistry Laboratory and biochemistry records information 2 CT Computed Tomagraphy records information 3 CT-Annotation Computed Tomagraphy records radiologist annotations 4 CXR Chest X ray records information 5 CXR-Manual-Annotation Chest X ray records radiologist annotations 6 CXR-Qure-Annotation Chest X ray records Qure AI algorithm annotations 7 DST Drug sensitivity testing results records 8 Genomics Pathogen genomics records information 9 Patient-Case Patient case record information 10 Specimen Specimen record information 11 Treatment-Regimen Treatment and regiment record information</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <div class="links">
<h2>Links</h2>
<ul class="list-unstyled">
<li>Download from CRAN (TBA) at <br><a href="https://github.com/niaid/tbportals.depot.api">https://​github.com/​niaid/​tbportals.depot.api</a>
</li>
<li>Browse source code at <br><a href="https://github.com/niaid/tbportals.depot.api">https://​github.com/​niaid/​tbportals.depot.api</a>
</li>
<li>Report a bug at <br><a href="https://github.com/niaid/tbportals.depot.api/issues">https://​github.com/​niaid/​tbportals.depot.api/​issues</a>
</li>
<li>Learn more about TB Portals at <br><a href="https://tbportals.niaid.nih.gov">https://​tbportals.niaid.nih.gov</a>
</li>
</ul>
</div>
<div class="license">
<h2>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small>CC0</small></li>
</ul>
</div>
<div class="developers">
<h2>Developers</h2>
<ul class="list-unstyled">
<li>
<a href="mailto:gabriel.rosenfeld@nih.gov">Gabriel Rosenfeld</a> <br><small class="roles"> Author </small>  </li>
<li>
<a href="mailto:qinlu.wang@nih.gov">Qinlu Wang</a> <br><small class="roles"> Maintainer </small>  </li>
</ul>
</div>

  <div class="dev-status">
<h2>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://github.com/niaid/tbportals.depot.api/actions"><img src="https://github.com/niaid/tbportals.depot.api/workflows/R-CMD-check/badge.svg" alt="R-CMD-check"></a></li>
</ul>
</div>
</div>
</div>


      <footer><div class="copyright">
  <p>Developed by <a href="mailto:gabriel.rosenfeld@nih.gov">Gabriel Rosenfeld</a>, <a href="mailto:qinlu.wang@nih.gov">Qinlu Wang</a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
