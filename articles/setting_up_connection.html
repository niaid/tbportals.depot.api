<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Setting up connection to API â€¢ tbportals.depot.api</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Setting up connection to API">
<meta property="og:description" content="tbportals.depot.api">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">tbportals.depot.api</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/pulling_data_from_depot_cohort.html">Pulling data from the API and filtering on records in a DEPOT created cohort</a>
    </li>
    <li>
      <a href="../articles/setting_up_connection.html">Setting up connection to API</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/niaid/tbportals.depot.api/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="setting_up_connection_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Setting up connection to API</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/niaid/tbportals.depot.api/blob/HEAD/vignettes/setting_up_connection.Rmd" class="external-link"><code>vignettes/setting_up_connection.Rmd</code></a></small>
      <div class="hidden name"><code>setting_up_connection.Rmd</code></div>

    </div>

    
    
<div class="section level4">
<h4 id="establishing-credentials-and-saving-them-locally-into--renviron">Establishing credentials and saving them locally into .Renviron<a class="anchor" aria-label="anchor" href="#establishing-credentials-and-saving-them-locally-into--renviron"></a>
</h4>
<p>Prior to using the tbportals.depot.api R package, it will be necessary to request access to the data from <a href="https://tbportals.niaid.nih.gov/download-data" class="external-link">TB portals website</a>. Once the DUA process has been completed, you will be able to request access to the API that serves the tidy analytic data from TB Portals.</p>
<p>You should receive an email with a secret that is only for your use and which can be used along with the email address you provided to establish an API token. After you have this information, see below for the code to save these credentials locally to create your unique token. You will need to be running Rstudio as the code below will generate an interactive window to input this information securely.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/niaid/tbportals.depot.api" class="external-link">tbportals.depot.api</a></span><span class="op">)</span>

<span class="co"># Save the secret credentials locally in your own .Renviron file</span>
<span class="fu"><a href="../reference/store_secret_credentials.html">store_secret_credentials</a></span><span class="op">(</span><span class="op">)</span>

<span class="co"># After inputting the information via the prompts, you can access it with the following functions</span>
<span class="fu"><a href="../reference/get_secret.html">get_secret</a></span><span class="op">(</span><span class="op">)</span>
<span class="fu"><a href="../reference/get_secret_email.html">get_secret_email</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
</div>
<div class="section level4">
<h4 id="generating-an-api-token">Generating an API token<a class="anchor" aria-label="anchor" href="#generating-an-api-token"></a>
</h4>
<p>Once secret credentials have been saved locally, they will be available for generating the API token. A convenience function is provided to allow for generation of a token, which needs to be done periodically without having to directly input the secret or email address associated with the secret provided these have been saved locally. Alternatively, these arguments can be provided to the function but this is not best practice as it is stored to your local R history file. Be sure to delete your history if using the latter approach.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Generate a temporary token for use with API calls, no arguments necessary if secret credentials saved</span>
<span class="va">TOKEN</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_token.html">get_token</a></span><span class="op">(</span><span class="op">)</span>

<span class="co"># Alternatively, directly input secret credentials, riskier practice due to this being saved in your history</span>
<span class="va">TOKEN</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_token.html">get_token</a></span><span class="op">(</span>email_address <span class="op">=</span> <span class="st">"PASTE_YOUR_EMAIL_ADRESS"</span>, secret <span class="op">=</span> <span class="st">"PASTE_YOUR_SECRET"</span><span class="op">)</span></code></pre></div>
</div>
<div class="section level4">
<h4 id="making-an-api-call">Making an API call<a class="anchor" aria-label="anchor" href="#making-an-api-call"></a>
</h4>
<p>After you have generated a temporary token string, you can now make API calls. For a list of end points that are available, please see <a href="https://analytic.tbportals.niaid.nih.gov/index.html" class="external-link">API documentation</a>. A convenience function is provided that can take the name of an end point and return a class of tidy_depot_api with the resulting data.frame of the returned JSON content along with information about the specific call itself including status codes in the case of a malformed request.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># See an example of making a request for the data contained in the Biochemistry end point</span>
<span class="va">REQUEST</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tidy_depot_api.html">tidy_depot_api</a></span><span class="op">(</span>path <span class="op">=</span> <span class="st">"Biochemistry"</span>, token <span class="op">=</span> <span class="va">TOKEN</span><span class="op">)</span>

<span class="co"># The JSON data from the API is returned in the content section as a data.frame</span>
<span class="va">REQUEST</span><span class="op">$</span><span class="va">content</span>

<span class="co"># The end point can be found in the path section</span>
<span class="va">REQUEST</span><span class="op">$</span><span class="va">path</span>

<span class="co"># Specific information about the httr request can be found in the response section</span>
<span class="va">REQUEST</span><span class="op">$</span><span class="va">response</span></code></pre></div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by <a href="mailto:gabriel.rosenfeld@nih.gov">Gabriel Rosenfeld</a>, <a href="mailto:qinlu.wang@nih.gov">Qinlu Wang</a>.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.2.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
