<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Pulling data from the API and filtering on records in a DEPOT created cohort • tbportals.depot.api</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Pulling data from the API and filtering on records in a DEPOT created cohort">
<meta property="og:description" content="tbportals.depot.api">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">tbportals.depot.api</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.0.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/pulling_data_from_depot_cohort.html">Pulling data from the API and filtering on records in a DEPOT created cohort</a>
    </li>
    <li>
      <a href="../articles/setting_up_connection.html">Setting up connection to API</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/niaid/tbportals.depot.api/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Pulling data from the API and filtering on
records in a DEPOT created cohort</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/niaid/tbportals.depot.api/blob/HEAD/vignettes/pulling_data_from_depot_cohort.Rmd" class="external-link"><code>vignettes/pulling_data_from_depot_cohort.Rmd</code></a></small>
      <div class="hidden name"><code>pulling_data_from_depot_cohort.Rmd</code></div>

    </div>

    
    
<div class="section level4">
<h4 id="identifying-the-right-cohort-from-depot">Identifying the right cohort from DEPOT<a class="anchor" aria-label="anchor" href="#identifying-the-right-cohort-from-depot"></a>
</h4>
<p>Prior to using this functionality, a user must be registered to use
the <a href="https://depot.tbportals.niaid.nih.gov" class="external-link">DEPOT tool</a> and
must have created and saved a cohort with the tool. Users can find the
cohorts they saved <a href="https://depot.tbportals.niaid.nih.gov/#/saved-cohorts" class="external-link">here</a>.</p>
<p>In the website above with your saved cohorts, you will see a table
with the following columns “NAME” corresponding to the name of the
cohort you created using DEPOT and “ID” which is the unique cohort ID
you will need if wanting to pull the data for just these cases using the
tbportals.depot.api package.</p>
</div>
<div class="section level4">
<h4 id="pulling-data-from-an-endpoint-for-just-the-cases-in-the-depot-cohort-of-interest">Pulling data from an endpoint for just the cases in the DEPOT cohort
of interest<a class="anchor" aria-label="anchor" href="#pulling-data-from-an-endpoint-for-just-the-cases-in-the-depot-cohort-of-interest"></a>
</h4>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># See an example of making a request for the data contained in the Biochemistry end point</span></span>
<span><span class="va">REQUEST</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tidy_depot_api.html">tidy_depot_api</a></span><span class="op">(</span>path <span class="op">=</span> <span class="st">"Biochemistry"</span>, token <span class="op">=</span> <span class="va">TOKEN</span>, cohortId <span class="op">=</span> <span class="st">"PASTE cohort ID number Here"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># The JSON data from the API is returned in the content section as a data.frame</span></span>
<span><span class="va">REQUEST</span><span class="op">$</span><span class="va">content</span></span>
<span></span>
<span><span class="co"># The end point can be found in the path section</span></span>
<span><span class="va">REQUEST</span><span class="op">$</span><span class="va">path</span></span>
<span></span>
<span><span class="co"># Specific information about the httr request can be found in the response section</span></span>
<span><span class="va">REQUEST</span><span class="op">$</span><span class="va">response</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="filtering-on-the-records-relating-to-the-cohort-id-of-interest">Filtering on the records relating to the cohort ID of interest<a class="anchor" aria-label="anchor" href="#filtering-on-the-records-relating-to-the-cohort-id-of-interest"></a>
</h4>
<p>Given the requirements of TB portals, the following example below
will be for purely fake hypothetical data that has similar structure as
you would receive from the API call. Only the first few columns showing
fake records with ids, relative dates, and specimen info columns are
shown without corresponding lab test types. The final column for
filtering on the cohort records is also shown.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'dplyr'</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:stats':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     filter, lag</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:base':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     intersect, setdiff, setequal, union</span></span></code></pre></div>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://www.rforge.net/uuid" class="external-link">uuid</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Structure of a hypothetical data.frame from REQUESTS$content</span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="st">"patient_id"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/uuid/man/UUIDgenerate.html" class="external-link">UUIDgenerate</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">5</span><span class="op">)</span>,</span>
<span>                 <span class="st">"condition_id"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/uuid/man/UUIDgenerate.html" class="external-link">UUIDgenerate</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">5</span><span class="op">)</span>,</span>
<span>                 <span class="st">"specimen_id"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/uuid/man/UUIDgenerate.html" class="external-link">UUIDgenerate</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">5</span><span class="op">)</span>,</span>
<span>                 <span class="st">"observationfhir_id"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/uuid/man/UUIDgenerate.html" class="external-link">UUIDgenerate</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">5</span><span class="op">)</span>,</span>
<span>                 <span class="st">"test_date"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">0</span><span class="op">:</span><span class="fl">100</span>, size <span class="op">=</span> <span class="fl">5</span><span class="op">)</span>,</span>
<span>                 <span class="st">"specimen_collection_site"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"blood"</span>, <span class="fl">5</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    specimen_collection_date <span class="op">=</span> <span class="va">test_date</span>,</span>
<span>    in_requested_cohort <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"No"</span>, <span class="st">"Yes"</span>, <span class="st">"Yes"</span>, <span class="st">"No"</span>, <span class="st">"No"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">df</span></span>
<span><span class="co">#&gt;                             patient_id                         condition_id</span></span>
<span><span class="co">#&gt; 1 dfa3ceb3-38bb-47cb-b1b7-17e6659d7e4d 95768621-e04e-47cc-a835-96cfbcd8fe12</span></span>
<span><span class="co">#&gt; 2 ca7f21a5-85f6-461e-bfe2-034f517ad5ca 5f51e03c-ecb9-43fb-b289-4da52b9c44c8</span></span>
<span><span class="co">#&gt; 3 b7f889e4-358a-4dee-b17d-16496514634e d5fc5f93-a8f1-4341-8fdd-87dbab279fd4</span></span>
<span><span class="co">#&gt; 4 9acf855e-bcc7-4cc3-8325-11d6595b5cbc 9ea3778d-0e67-420e-9b95-9d6c5f82c2a2</span></span>
<span><span class="co">#&gt; 5 1bf2742c-ef36-4379-add1-fdc36ea48791 85daac8a-07e4-463e-9d52-2af81e55a03b</span></span>
<span><span class="co">#&gt;                            specimen_id                   observationfhir_id</span></span>
<span><span class="co">#&gt; 1 75d51497-acd9-4804-a2a8-d8d0573d20dc 5772932d-19a8-4b1b-8907-021d998962b8</span></span>
<span><span class="co">#&gt; 2 9e24896f-f6b8-4ccf-abc5-4b9732220cc5 f8d339d0-a416-4278-b0ed-f7c94a2d1ffb</span></span>
<span><span class="co">#&gt; 3 5705d156-a75f-4391-85e9-0df6d60e9714 f39cf79c-f893-4db0-b35f-c0afd74afb98</span></span>
<span><span class="co">#&gt; 4 309cf0a9-8b8e-44c0-b526-138ca9a7953d 61eff69f-c681-45bc-98de-1c1f5c22189b</span></span>
<span><span class="co">#&gt; 5 a1825e95-6c1e-4be9-b8ce-28b604621bbe d45fcdcb-472a-4ff6-9690-939d5f6ada49</span></span>
<span><span class="co">#&gt;   test_date specimen_collection_site specimen_collection_date</span></span>
<span><span class="co">#&gt; 1        44                    blood                       44</span></span>
<span><span class="co">#&gt; 2        22                    blood                       22</span></span>
<span><span class="co">#&gt; 3        75                    blood                       75</span></span>
<span><span class="co">#&gt; 4        62                    blood                       62</span></span>
<span><span class="co">#&gt; 5        46                    blood                       46</span></span>
<span><span class="co">#&gt;   in_requested_cohort</span></span>
<span><span class="co">#&gt; 1                  No</span></span>
<span><span class="co">#&gt; 2                 Yes</span></span>
<span><span class="co">#&gt; 3                 Yes</span></span>
<span><span class="co">#&gt; 4                  No</span></span>
<span><span class="co">#&gt; 5                  No</span></span></code></pre></div>
<p>To filter on records within the DEPOT cohort of interest, a user can
use the in_requested_cohort column matching on records with a “Yes”.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Filter on a hypothetical data.frame using only the records from a cohort ID of interest from the API call</span></span>
<span><span class="va">df_cohort</span> <span class="op">&lt;-</span> <span class="va">df</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">in_requested_cohort</span> <span class="op">==</span> <span class="st">"Yes"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">df_cohort</span></span>
<span><span class="co">#&gt;                             patient_id                         condition_id</span></span>
<span><span class="co">#&gt; 1 ca7f21a5-85f6-461e-bfe2-034f517ad5ca 5f51e03c-ecb9-43fb-b289-4da52b9c44c8</span></span>
<span><span class="co">#&gt; 2 b7f889e4-358a-4dee-b17d-16496514634e d5fc5f93-a8f1-4341-8fdd-87dbab279fd4</span></span>
<span><span class="co">#&gt;                            specimen_id                   observationfhir_id</span></span>
<span><span class="co">#&gt; 1 9e24896f-f6b8-4ccf-abc5-4b9732220cc5 f8d339d0-a416-4278-b0ed-f7c94a2d1ffb</span></span>
<span><span class="co">#&gt; 2 5705d156-a75f-4391-85e9-0df6d60e9714 f39cf79c-f893-4db0-b35f-c0afd74afb98</span></span>
<span><span class="co">#&gt;   test_date specimen_collection_site specimen_collection_date</span></span>
<span><span class="co">#&gt; 1        22                    blood                       22</span></span>
<span><span class="co">#&gt; 2        75                    blood                       75</span></span>
<span><span class="co">#&gt;   in_requested_cohort</span></span>
<span><span class="co">#&gt; 1                 Yes</span></span>
<span><span class="co">#&gt; 2                 Yes</span></span></code></pre></div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by <a href="mailto:gabriel.rosenfeld@nih.gov">Gabriel Rosenfeld</a>, Jingwen Gu.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
